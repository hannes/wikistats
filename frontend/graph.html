<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">

<title>Wikipedia Page Views</title>

<meta property="og:title" content="Wikipedia Page Views" />
<meta property="og:url" content="http://wikistats.ins.cwi.nl" />
<meta property="og:description" content="Wikipedia weekly page views" />


<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="css/rickshaw.min.css">
<link type="text/css" rel="stylesheet" href="css/jquery-ui.min.css">
<link rel="shortcut icon"
	href="http://bits.wikimedia.org/favicon/wikipedia.ico" />

<script src="js/d3.min.js"></script>
<script src="js/jquery.min.js"></script>

<script src="js/jquery-ui.min.js"></script>
<script src="js/purl.js"></script>
<script src="js/rickshaw.min.js"></script>
<script src="js/bootstrap.min.js"></script>


<script type="text/javascript">
	var switchTo5x = true;
</script>
<script type="text/javascript"
	src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">
	stLight.options({
		publisher : "ur-74a15812-3d58-4200-d949-339dfcd927ef",
		doNotHash : true,
		doNotCopy : true,
		hashAddressBar : false
	});
</script>


<style>
body {
	padding-top: 60px;
}

#chart {
	height: 500px; //
	width: 887px;
	background-color: #e9e9e9;
}

#footer {
	font-size: -10%;
	margin-top: 30px;
}

.brand {
	color: white;
}

.logos {
	text-align: right;
}

#legend {
	background-color: white;
	color: black;
}

.info a {
	text-decoration: underline;
}

.info {
	text-align: justify
}

#smoother {
	margin: 0 0 10px 16px;
	width: 100px;
}

#smoother .ui-slider-horizontal {
	height: 1px !important;
	border-color: #e0e0e0;
	margin-bottom: 10px;
}

#smoother .ui-slider-handle {
	border-color: #a0a0a0;
	height: 9px !important;
	width: 9px !important;
	top: -5px !important;
	border-radius: 6px;
	outline: none;
	cursor: pointer;
}

#slider {
	height: 14px;
}
</style>

</head>

<body>

	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<span class="brand">Wikipedia Page Views</span>

				<form class="navbar-search pull-left">
					<input id="page" type="text"
						placeholder="Start typing a page title hereâ€¦" class="search-query">
				</form>


				<div class="logos">
					<a href="http://www.monetdb.org"><img src="img/monetdb.png" /></a>&nbsp;<a
						href="http://www.cwi.nl/research-groups/Database-Architectures"><img
						src="img/cwi.png" /></a>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<noscript>
			<div class="row">
				<div class="span12"
					style="padding: 5px 3px 10px 10px; border: 2px solid red;">
					<p>
						This application absolutely requires <a
							ref="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a> to
						be enabled. Please...
					</p>
				</div>
			</div>
		</noscript>

		<div class="row">
			<div class="span10">
				<div id="chart"></div>
			</div>
			<div class="span2">
				<div id="legend"></div>

				<br>

				<div id="share" class="btn-group">
					<button id="startover" class="btn btn-mini">
						<i class="icon-remove"></i> restart
					</button>
					<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
						share <i class="icon-share"></i>
					</button>
					<ul class="dropdown-menu" id="share-entries">
						<li><span class="st_facebook sharer" displayText="Facebook"></span></li>
						<li><span class="st_twitter sharer" displayText="Tweet"></span></li>
						<li><span class="st_googleplus sharer" displayText="Google +"></span></li>
						<li><span class="st_linkedin sharer" displayText="LinkedIn"></span></li>
					</ul>
				</div>

			</div>
		</div>
		<div class="row">
			<div class="span10">
				<div id="slider"></div>
			</div>
		</div>

		<div class="row" id="footer">
			<div class="span10">
				<p class="info">
					<small>This graph shows weekly absolute page views for
						Wikipedia pages selected by <em>you</em>. The visualisation was
						developed at the <a
						href="http://www.cwi.nl/research-groups/Database-Architectures">CWI
							Database Architectures</a> group by <a
						href="http://hannes.muehleisen.org/">Hannes M&uuml;hleisen</a> in
						2013. Database contains 41.775.815 measurements from 688.444 pages
						between 2008 and mid-2013. Powered by <a
						href="http://www.monetdb.org/">MonetDB</a>, <a
						href="http://code.shutterstock.com/rickshaw/">Rickshaw</a> and <a
						href="http://twitter.github.io/bootstrap/">Bootstrap</a>. Icons by
						<a href="http://glyphicons.com/">Glyphicons</a>. Data taken from
						the <a href="http://dumps.wikimedia.org/other/pagecounts-raw/">Page
							view statistics for Wikimedia projects</a>. Code is <a
						href="https://github.com/hannesmuehleisen/wikistats">on GitHub</a>.
					</small>
				</p>
			</div>
		</div>
	</div>

	<script>
		(function() {

			var callback = "http://wikistats.ins.cwi.nl/export.php";

			var palette = new Rickshaw.Color.Palette();
			var time = new Rickshaw.Fixtures.Time();
			var tu = time.unit('week');
			var year = time.unit('year');

			var data = [];
			var graph = null;
			var legend = null;
			var highlighter;
			var remover;
			var slider;

			function initGraph() {
				graph = new Rickshaw.Graph({
					element : document.querySelector('#chart'),
					width : $("#chart").width(),
					height : $("#chart").height(),
					renderer : 'line',
					series : data,
					interpolation : "linear"
				});

				var hoverDetail = new Rickshaw.Graph.HoverDetail({
					graph : graph,
					xFormatter : function(x) {
						return tu.formatter(new Date(x * 1000)) + " - "
								+ tu.formatter(new Date((x + 604800) * 1000))
					},
					yFormatter : function(y) {
						return Math.floor(y) + " clicks"
					}
				});

				slider = new Rickshaw.Graph.RangeSlider({
					graph : graph,
					element : document.querySelector('#slider')
				});

			}

			$('#page').autocomplete({
				source : function(request, response) {
					$.ajax({
						url : callback,
						dataType : "jsonp",
						data : {
							suggest : request.term.replace(/ /g, '_')
						},
						success : function(data) {
							response($.map(data, function(item) {
								return {
									label : item.replace(/_/g, ' '),
									value : item
								}
							}));
						}
					});
				},
				minLength : 3,
				select : function(event, ui) {
					addPage(ui.item.value);
					this.value = "";
				},
			});

			$('#startover').click(function() {
				$('#chart').empty();
				$('#legend').empty();
				$('#slider').slider("destroy");
				$('#smoother').slider("destroy");

				graph = null;
				data = [];

				$('#startover').hide();
				$('#share').hide();

				window.location.hash = '';
				document.title = 'Wikipedia Page Views';
				$('#chart').css('background-color', '#e9e9e9');
			});

			$('#startover').hide();
			$('#share').hide();

			function addData(series) {
				$.each(series, function(i, d) {
					d.color = palette.color();
					d.key = d.name;
					d.name = d.name.replace(/_/g, ' ');
					data.push(d);
				});

				//Rickshaw.Series.zeroFill(data);

				if (graph == null) {
					initGraph();
				}
				graph.update();
				slider.update();

				$('#legend').empty();

				legend = new Rickshaw.Graph.Legend({
					graph : graph,
					element : document.querySelector('#legend')
				});

				highlighter = new Rickshaw.Graph.Behavior.Series.Highlight({
					graph : graph,
					legend : legend
				});

				/*remover = new Rickshaw.Graph.Behavior.Series.Remove({
					graph : graph,
					legend : legend
				});*/

				var xAxis = new Rickshaw.Graph.Axis.Time({
					graph : graph
				});

				var smoother = new Rickshaw.Graph.Smoother({
					graph : graph,
					element : $('#smoother')
				});

				xAxis.render();

				$('#chart').css('background-color', '#fff');
				$("#page").prop('disabled', false);
				$('#page').val('');
				$('#startover').show();
				$('#share').show();

				$.each(series, function(i, d) {
					if (window.location.hash.length < 2) {
						window.location.hash = '#' + d.key;
					} else {
						if (window.location.hash.search(d.key) == -1)
							window.location.hash += '|' + d.key;

					}
					if (document.title.search("@") == -1) {
						document.title = d.name + ' @ ' + document.title;
					} else {
						document.title = d.name + ' vs. ' + document.title;
					}

				});

				$('#share-entries .sharer').empty();
				$('#share-entries .sharer').attr('st_processed', null);
				$('#share-entries .sharer').attr('st_title', document.title);
				$('#share-entries .sharer').attr('st_url', window.location);
				stButtons.makeButtons();
				
			}

			function handleError(err) {
				console.log(err);
			}

			function addPage(terms) {
				if (!$.isArray(terms)) {
					var term = terms;
					terms = [];
					terms.push(term);
				}
				$("#page").prop('disabled', true);

				$('#chart').css('background-color', '#e9e9e9');

				$.ajax({
					url : callback,
					dataType : 'jsonp',
					success : addData,
					error : handleError,
					data : {
						page : terms.join("|")
					}
				});
			}

			// check if we have been given some url parameters to initialize our graph with
			var seriesp = window.location.hash;
			if (seriesp.length > 1) {
				var terms = seriesp.replace('#', '').split("|");
				addPage(terms);
			}
		})();
	</script>



</body>
</html>
